<app-summary-nav-bar></app-summary-nav-bar>

<main class="summary-content">
    @if(summary(); as summary) {
    <div class="summary-header animate-slide-up">
        <h1>{{ summary.title }}</h1>
        <p class="summary-meta">Audio Summary</p>
    </div>

    <div class="segments-container">
        @if(summary.status === 'processing') {
        <app-loader></app-loader>
        }
        @else {
        @for (item of content(); track item.start + item.end; let i = $index) {
        <article class="segment-card animate-slide-up" [style.animation-delay]="(i * 50) + 'ms'">
            <header class="segment-header">
                <span class="segment-number">{{ i + 1 }}</span>
                <div class="segment-info">
                    <h3>Segment {{ i + 1 }}</h3>
                    <span class="segment-time">{{ item.start }} â€“ {{ item.end }}</span>
                </div>
                <button class="transcript-toggle" (click)="toggleTranscript(i)"
                    [class.active]="expandedTranscripts()[i]">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                        <polyline points="14 2 14 8 20 8" />
                        <line x1="16" y1="13" x2="8" y2="13" />
                        <line x1="16" y1="17" x2="8" y2="17" />
                    </svg>
                    {{ expandedTranscripts()[i] ? 'Hide' : 'Show' }} Transcript
                </button>
            </header>

            <div class="segment-body">
                <p class="segment-summary">{{ item.summary }}</p>

                @if (expandedTranscripts()[i] && item.transcript_text) {
                <div class="segment-transcript">
                    <div class="transcript-text">{{ item.transcript_text }}</div>
                </div>
                }

                @if (item.key_points?.length) {
                <div class="segment-section">
                    <h4>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M9 11l3 3L22 4" />
                            <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11" />
                        </svg>
                        Key Points
                    </h4>
                    <ul class="key-points-list">
                        @for (point of item.key_points; track point) {
                        <li>{{ point }}</li>
                        }
                    </ul>
                </div>
                }

                @if (item.notable_quotes?.length) {
                <div class="segment-section">
                    <h4>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path
                                d="M3 21c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2H4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2 2s-1 .008-1 1.031V21z" />
                            <path
                                d="M15 21c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2h-4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2 2s-1 .008-1 1.031V21z" />
                        </svg>
                        Notable Quotes
                    </h4>
                    <div class="quotes-container">
                        @for (quote of item.notable_quotes; track quote) {
                        <blockquote class="quote">"{{ quote }}"</blockquote>
                        }
                    </div>
                </div>
                }
            </div>
        </article>
        }

        <!-- Full transcript fallback for older summaries without chunk transcripts -->
        <section class="transcript-section animate-slide-up">
            <h2>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                    <polyline points="14 2 14 8 20 8" />
                    <line x1="16" y1="13" x2="8" y2="13" />
                    <line x1="16" y1="17" x2="8" y2="17" />
                    <polyline points="10 9 9 9 8 9" />
                </svg>
                Full Transcript
            </h2>
            <div class="transcript-content">
                <p class="transcript">{{ summary.transcript }}</p>
            </div>
        </section>
    }
    </div>
    }
</main>