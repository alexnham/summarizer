<!-- Modal -->
<div class="modal">
  <div class="modal-content">
    <!-- Header with Close Button -->
    <div class="modal-header">
      <h2>Upload Audio</h2>
    </div>

    <!-- Status Message -->
    @if (status() !== 'idle') {
      <div class="status-banner" [class.status-creating]="status() === 'creating'"
           [class.status-transcribing]="status() === 'transcribing'"
           [class.status-completed]="status() === 'completed'"
           [class.status-error]="status() === 'error'">
        @if (status() === 'creating' || status() === 'transcribing') {
          <div class="status-spinner"></div>
        }
        @if (status() === 'completed') {
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
            <polyline points="22 4 12 14.01 9 11.01"/>
          </svg>
        }
        @if (status() === 'error') {
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <line x1="15" y1="9" x2="9" y2="15"/>
            <line x1="9" y1="9" x2="15" y2="15"/>
          </svg>
        }
        <span>{{ statusMessage() }}</span>
      </div>
    }

    <!-- Form -->
    <form (ngSubmit)="transcribe()" class="modal-form">
      <label for="audio-file">Select Audio File</label>
      <input
        id="audio-file"
        type="file"
        accept="audio/*,video/*"
        (change)="onFileSelected($event)"
        class="modal-input"
        [disabled]="status() === 'creating' || status() === 'transcribing'"
      />

      <label for="audio-title">Title</label>
      <input
        id="audio-title"
        type="text"
        (change)="onTitleChange($event)"
        name="title"
        placeholder="Enter title"
        class="modal-input"
        [disabled]="status() === 'creating' || status() === 'transcribing'"
      />

      <!-- Transcription Options Section -->
      <div class="options-section">
        <h3 class="options-title">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="3"/>
            <path d="M12 1v4M12 19v4M4.22 4.22l2.83 2.83M16.95 16.95l2.83 2.83M1 12h4M19 12h4M4.22 19.78l2.83-2.83M16.95 7.05l2.83-2.83"/>
          </svg>
          Transcription Options
        </h3>
        
        <div class="options-grid">
          <!-- Language Selection -->
          <div class="option-group">
            <label for="language-select" class="option-label">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <line x1="2" y1="12" x2="22" y2="12"/>
                <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
              </svg>
              Language
            </label>
            <select 
              id="language-select"
              class="modal-select"
              [disabled]="status() === 'creating' || status() === 'transcribing'"
              (change)="onLanguageChange($event)"
            >
              @for (lang of languages; track lang.code) {
                <option [value]="lang.code" [selected]="selectedLanguage() === lang.code">
                  {{ lang.name }}
                </option>
              }
            </select>
          </div>

          <!-- Speaker Diarization Toggle -->
          <div class="option-group">
            <label class="toggle-label">
              <span class="toggle-text">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                  <circle cx="9" cy="7" r="4"/>
                  <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                  <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                </svg>
                Multiple Speakers
              </span>
              <div class="toggle-switch">
                <input 
                  type="checkbox" 
                  id="diarize-toggle"
                  [checked]="diarize()"
                  (change)="onDiarizeChange($event)"
                  [disabled]="status() === 'creating' || status() === 'transcribing'"
                />
                <span class="toggle-slider"></span>
              </div>
            </label>
            <span class="option-hint">Enable to identify different speakers</span>
          </div>

          <!-- Smart Format Toggle -->
          <div class="option-group">
            <label class="toggle-label">
              <span class="toggle-text">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M12 20h9"/>
                  <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/>
                </svg>
                Smart Format
              </span>
              <div class="toggle-switch">
                <input 
                  type="checkbox" 
                  id="smart-format-toggle"
                  [checked]="smartFormat()"
                  (change)="onSmartFormatChange($event)"
                  [disabled]="status() === 'creating' || status() === 'transcribing'"
                />
                <span class="toggle-slider"></span>
              </div>
            </label>
            <span class="option-hint">Auto-format numbers, dates, and more</span>
          </div>
        </div>
      </div>

      <button
        type="button"
        (click)="transcribe()"
        [disabled]="!selectedFile || status() === 'creating' || status() === 'transcribing'"
        class="modal-btn"
      >
        @if (status() === 'creating' || status() === 'transcribing') {
          Processing...
        } @else {
          Upload & Transcribe
        }
      </button>
    </form>
  </div>
</div>